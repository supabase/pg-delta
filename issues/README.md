# pg-diff Missing Test Coverage Issues

This directory contains individual GitHub-style issues for missing test coverage in pg-diff compared to migra. Each issue is self-contained and can be tackled independently.

## Issue Overview

Based on analysis of migra's comprehensive test fixtures, we've identified 9 key areas where pg-diff needs additional test coverage:

## ðŸ”´ High Priority Issues (Critical for Production)

### [#001: Identity Columns Test Coverage](./001-identity-columns-tests.md)
- **Estimated Effort**: 2-3 days
- **Description**: Add tests for `GENERATED ALWAYS AS IDENTITY` and `GENERATED BY DEFAULT AS IDENTITY` columns
- **Key Features**: Identity column creation, type conversion, adding/removing identity from columns

### [#002: Generated Columns Test Coverage](./002-generated-columns-tests.md)
- **Estimated Effort**: 2-3 days  
- **Description**: Add tests for `GENERATED ALWAYS AS (...) STORED` computed columns
- **Key Features**: Generated expressions, dropping expressions, complex computed values

### [#003: Privileges and Grants Test Coverage](./003-privileges-grants-tests.md)
- **Estimated Effort**: 3-4 days
- **Description**: Add comprehensive tests for `GRANT`/`REVOKE` operations on tables, views, functions
- **Key Features**: Table/view/function privileges, role-based permissions, privilege modifications

### [#004: Enum Type Edge Cases Test Coverage](./004-enum-edge-cases-tests.md)
- **Estimated Effort**: 2-3 days
- **Description**: Extend existing enum tests to handle complex scenarios like enum replacement patterns
- **Key Features**: Enum with defaults, complex replacement patterns, cross-schema dependencies

**High Priority Total**: ~9-13 days

## ðŸŸ¡ Medium Priority Issues (Important for Completeness)

### [#005: Collations Test Coverage](./005-collations-tests.md)
- **Estimated Effort**: 2-3 days
- **Description**: Add tests for PostgreSQL collations and column collation changes
- **Key Features**: Collation creation, column collation changes, ICU/libc providers

### [#006: Table Inheritance Test Coverage](./006-table-inheritance-tests.md)
- **Estimated Effort**: 3-4 days
- **Description**: Add tests for PostgreSQL table inheritance using `INHERITS` clause
- **Key Features**: Single/multi-level inheritance, adding/removing inheritance, constraint handling

### [#007: Extension Management Test Coverage](./007-extension-management-tests.md)
- **Estimated Effort**: 2-3 days
- **Description**: Add tests for PostgreSQL extension operations and version management
- **Key Features**: Extension creation/removal, version updates, dependency handling

### [#008: Schema Filtering Test Coverage](./008-schema-filtering-tests.md)
- **Estimated Effort**: 3-4 days
- **Description**: Add tests for schema inclusion/exclusion and cross-schema dependencies
- **Key Features**: Single schema operations, schema exclusion, dependency filtering

**Medium Priority Total**: ~10-14 days

## ðŸŸ¢ Low Priority Issues (Nice to Have)

### [#009: Comprehensive Integration Test](./009-comprehensive-integration-test.md)
- **Estimated Effort**: 2-3 days
- **Description**: Add comprehensive test combining multiple object types (like migra's "everything" fixture)
- **Key Features**: Mixed object types, complex dependencies, regression testing

**Low Priority Total**: ~2-3 days

## Implementation Strategy

### Phase 1: High Priority (Weeks 1-3)
Focus on the most critical missing functionality that affects production use cases:
1. Identity Columns (#001)
2. Generated Columns (#002) 
3. Privileges and Grants (#003)
4. Enum Edge Cases (#004)

### Phase 2: Medium Priority (Weeks 4-6)
Add important but less critical features:
1. Collations (#005)
2. Extension Management (#007)
3. Table Inheritance (#006)
4. Schema Filtering (#008)

### Phase 3: Low Priority (Week 7)
Add comprehensive regression testing:
1. Comprehensive Integration Test (#009)

## Total Estimated Effort
- **High Priority**: 9-13 days
- **Medium Priority**: 10-14 days  
- **Low Priority**: 2-3 days
- **Total**: 21-30 days (4-6 weeks)

## Notes

- Each issue includes detailed implementation plans with code examples
- All tests follow the existing `roundtripFidelityTest` pattern
- Issues reference specific migra fixtures for validation
- Test coverage will significantly improve pg-diff's robustness for production use

## Getting Started

1. Review the high priority issues first
2. Each issue is self-contained and can be worked on independently
3. Follow the implementation plans provided in each issue
4. Use migra fixtures as reference for expected behavior
5. Ensure all tests pass across supported PostgreSQL versions

## Dependencies

Some issues may have dependencies:
- Schema Filtering (#008) may require API extensions
- Extension tests (#007) depend on available extensions in test environment
- Comprehensive test (#009) builds on patterns from other issues
